---
import { getCollection, render } from "astro:content";
import type { CollectionEntry } from "astro:content";
import BaseHead from "@/components/BaseHead.astro";
import Footer from "@/components/Footer.astro";
import P5Background from "@/components/P5Background.astro";
import { SITE_TITLE, SECTION_ID } from "@/consts";

export async function getStaticPaths() {
  const tutorials = await getCollection("tutorials");
  return tutorials.map((tutorial) => ({
    params: { slug: tutorial.id },
    props: tutorial,
  }));
}

type Props = CollectionEntry<"tutorials">;

const tutorial = Astro.props;
const { Content } = await render(tutorial);

const difficultyColors = {
  beginner: "bg-green-100 text-green-800",
  intermediate: "bg-yellow-100 text-yellow-800",
  advanced: "bg-red-100 text-red-800",
};
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead
      title={tutorial.data.title}
      description={tutorial.data.description || "Tutorial"}
      image="/opengraph.jpg"
    />
  </head>
  <body>
    <P5Background />

    <header>
      <div>
        <a href="/">
          <h1 class="heading-3 !leading-normal">
            {`${SITE_TITLE} (${SECTION_ID})`}
          </h1>
        </a>
        <a href="/tutorials">‚Üê Back to Tutorials</a>
        <h2 class="heading-1">{tutorial.data.title}</h2>

        <div class="tutorial-meta">
          {
            tutorial.data.difficulty && (
              <span
                class={`difficulty ${difficultyColors[tutorial.data.difficulty]}`}
              >
                {tutorial.data.difficulty}
              </span>
            )
          }
          {
            tutorial.data.duration && (
              <span class="duration">{tutorial.data.duration}</span>
            )
          }
        </div>

        {
          tutorial.data.tags && tutorial.data.tags.length > 0 && (
            <div class="tutorial-tags">
              {tutorial.data.tags.map((tag) => (
                <span class="tag">{tag}</span>
              ))}
            </div>
          )
        }
      </div>
      <Footer />
    </header>

    <main class="tutorial-content col-span-2">
      <Content />
    </main>
    <script src="../../scripts/page-animations.js"></script>
  </body>
</html>

<style>
  .tutorial-meta {
    display: flex;
    gap: 1rem;
    opacity: 0.8;
    margin: 1rem 0;
    font-size: 0.9rem;
  }

  .difficulty {
    border-radius: 4px;
    padding: 0.2rem 0.5rem;
    font-weight: bold;
    font-size: 0.8rem;
  }

  .tutorial-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin: 1rem 0;
  }

  .tag {
    border-radius: 4px;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.2rem 0.5rem;
    font-size: 0.8rem;
  }

  .tutorial-links {
    display: flex;
    gap: 1rem;
    margin: 1rem 0;
  }

  .btn-primary,
  .btn-secondary {
    border-radius: 4px;
    padding: 0.5rem 1rem;
    font-weight: bold;
    text-decoration: none;
  }

  .btn-primary {
    background: #0066cc;
    color: white;
  }

  .btn-secondary {
    border: 1px solid rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.1);
    color: inherit;
  }

  .tutorial-content {
    padding: var(--margin);
  }
</style>
